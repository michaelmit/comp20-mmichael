<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Assign-2</title>
    <link rel="stylesheet" type="text/css" href="mystyle.css"/> 
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js"></script>
    <!-- Using Google Maps API, Geolocator and JSON -->
</head>
    <body onload="loadMessages()">
    <section>
            <h1>Messages</h1>
            <div id="messages">Loading...</div>
    </section>

    <!-- space to display the map -->
    <!-- <div id="map-canvas"></div> -->
    <div id="map-canvas" style="clear:both; height:500px;"></div> 


    <script>
    // callbalk to retrieve my position
    // retrieve my position using Geolocator

    // var myPos;
    // function geoCallback (position) {
    //     navigator.geolocation.getCurrentPosition(geoCallback);
    //     myPos = position.coords;
    //     console.log('Your current position is:');
    //     console.log(`Latitude : ${myPos.latitude}`);
    //     console.log(`Longitude: ${myPos.longitude}`);
    // }


    var myPos = {};

    // XMLHttp Request
    function loadMessages() {


            // navigator.geolocation.getCurrentPosition(geoCallback);
            // function geoCallback (position) {
            //     myPos = position.coords;
            //     console.log('Your current position is:');
            //     console.log(`Latitude : ${myPos.latitude}`);
            //     console.log(`Longitude: ${myPos.longitude}`);
            // }



			// Step 1: Make an instance of XMLHttpRequest
			request = new XMLHttpRequest();
			// Step 2: Set up HTTP request
			request.open("POST", "https://defense-in-derpth.herokuapp.com/sendLocation", true);

            // request.send('param1=val1&param2=val2&param3=val3')
            request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

			// Step 3: Set up callback on what to do when response is received
	        request.onreadystatechange = function() {
       	        // Step 3A: get the response text if and only if readyState is 4
			    if (request.readyState == 4 && request.status == 200) {
                    console.log("success");
                    // Step 5: do something with the response data (i.e., the JSON)
                    rawData = request.responseText;

                    var messages = JSON.parse(rawData);

                    console.log(messages);
                    if(typeof messages =='object')
                    {
                        console.log("It is JSON");
                    }
                    if(typeof messages == 'string')
                    {
                        console.log("It is String");
                    }

                    console.log(rawData.length);
                    // output = "<ul>";
                    // for (count = 0; count < messages.length; count++) {
                    //     output += "<li>" + messages[count].content + " => " + messages[count].username + "</li>";
                    // }
                    // output += "</ul>";
                    // document.getElementById("messages").innerHTML = output;

                    output = "<ul>";
                    for (count = 0; count < 10; count++) {
                        {

                            // output += "<li>" + "howdy" + "</li>" ;
                            // for (i = 0; i < rawData["people"].length; i++) {
                                 output += "<li>" + (messages['people'])[count]['login'] + "</li>" ;

                        }
                        // output += "<li>" + messages[count].people + " => " + messages[count].username + "</li>";
                    }
                    output += "</ul>";
                    document.getElementById("messages").innerHTML = output;



                }
            }
			// Step 4: Fire off the request
            // var postMdg = JSON.stringify({ login: "KzQy5Jj1", lat : myPos.latitute, lng : myPos.longitude });
            // request.send(postMsg);

            myPos.latitude  = 42.4118037;
            myPos.longitude = -71.11929529999999;

            var la = "42.4118037";
            var lo = "-71.11929529999999";

            var params = "login=KzQy5Jj1&lat="+la+"&lng="+lo;
            request.send(params);
            // var params = "login=&=binny";


            // console.log('Your current position is:');
            // console.log(`Latitude : ${myPos.latitude}`);
            // console.log(`Longitude: ${myPos.longitude}`);
        }

        // ******************************************************************
        /*
        * The code below will initialize a google maps view
        * and center it at my geo-location.
        * Map is placed on html div# "my-canvas"
        * CSS for map is defined in css style sheet
        */
        function initialize() {
            var mapOptions = {
            // center: new google.maps.LatLng(42.4118037,-71.11929529999999),
            center: new google.maps.LatLng(myPos.latitude, myPos.longitude),
            zoom: 13,
            mapTypeId: google.maps.MapTypeId.ROADMAP
            };

            var map = new google.maps.Map(document.getElementById("map-canvas"),
            mapOptions);

            // variable that sets the URL to the new image
            var icon_person = {
                url: "img/map-marker-person-1.png", // url
                scaledSize: new google.maps.Size(50, 50), // scaled size
                origin: new google.maps.Point(0,0), // origin
                anchor: new google.maps.Point(0, 0) // anchor
            };

           // my position marker 
            var marker_myPos = new google.maps.Marker({
                position: mapOptions.center,
                map: map,
                title:"My Location in Medford",
                icon: icon_person // set new image
            });

        }
        google.maps.event.addDomListener(window, 'load', initialize);

        // ******************************************************************


        // ******************************************************************
        /*
        * The code below will add a marker for my geo-location 
        * A custom icon is used that represents all people on this map
        */





    </script>
    
</body>
</html>